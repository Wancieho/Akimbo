var akimbo={};!function(e){e.App={},e.App.Services={},e.App.Components={},e.App.Controllers={},e.App.Classes={},e.App.Config={},document.onreadystatechange=function(){"complete"===this.readyState&&new e.Main}}(akimbo),function(e){function t(){null===o&&(o=this,o.router=new e.Router,window.onpopstate=function(){n()},n())}function n(){var e="";void 0!==history.pushState&&(e="http:"===window.location.protocol?window.location.pathname.replace("/",""):"",console.debug(e)),o.router.navigate(e)}e.Main=t;var o=null}(akimbo),function(e){function t(){null===n&&(n=this)}e.Cache=t;var n=null,o={};t.prototype={get:function(e){return void 0!==o[e]?o[e]:null},set:function(e,t){if(void 0===t)throw"Cache.set(): "+e+" value cannot be undefined";o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}(akimbo),function(e){function t(){l=this,l.event=new e.Event}function n(e){var t="function"==typeof e,n=t&&(e.name&&["",e.name]||e.toString().match(/function ([^\(]+)/));return!t&&"not a function"||n&&n[1]||"anonymous"}function o(e){$("["+e.meta.selector+"]").load(e.meta.templateUrl,function(){$("a").on("click",function(e){e.preventDefault()}),void 0===e.meta.templates?i(e):(e.templatesLoaded=0,$.each(e.meta.templates,function(t){a.apply(e,[e.meta.templates[t]])}))})}function i(t){void 0!==t.constructor&&setTimeout(function(){t.constructor(t)},100),void 0!==t.before&&setTimeout(function(){t.before(t)},100),void 0!==t.after&&setTimeout(function(){t.after(t)},150),$("["+t.meta.selector+"]").fadeIn(200),void 0!==t.meta.components&&t instanceof e.App.Core==!1&&l.loadComponents(t.meta.components)}function a(e){var t=this;$.ajax({url:e.template}).done(function(n){e.html=n,++t.templatesLoaded===$.map(t.meta.templates,function(e,t){return[e]}).length&&i(t)})}e.Component=t;var r=[],l=null,c=!1;t.prototype={load:function(t){if(void 0===t)throw'"'+t+'" not found';var i=new t;i.name=n(t);var a=JSON.parse(JSON.stringify(i));if(i.getDefaultInstance=function(){return a},r.unshift(i),i instanceof e.App.Core==!1){if(void 0===i.meta)throw'"'+i.constructor.name+'" meta property must be defined';if(void 0===i.meta.selector)throw'"'+i.constructor.name+'" meta property selector must be defined';if(void 0===i.meta.templateUrl||""===i.meta.templateUrl)throw'"'+i.constructor.name+'" meta property templateUrl must be defined';void 0===i.meta.layout&&(i.meta.layout="index"),c?o(i,i.constructor.name):$("[data-layout]").load("src/app/layouts/"+i.meta.layout+".html",function(){c=!0,l.event.broadcast("layout.loaded")})}return l.event.listen("layout.loaded",function(){i instanceof e.App.Core==!1&&o(i,i.constructor.name)}),i},loadComponents:function(e){$.each(e,function(e,t){l.load(t)})},setLayoutHasLoaded:function(e){c=e},unload:function(){$.each(r,function(e,t){void 0!==t.unload&&t.unload(),$("["+t.meta.selector+"]").empty().remove(),t=null}),r=[],$("[data-layout]").empty()}}}(akimbo),function(e){function t(){null===n&&(n=this)}e.Config=t;var n=null;t.prototype={get:function(t){return e.App.Config[t]}}}(akimbo),function(e){function t(){}e.Event=t;var n=[];t.prototype={listen:function(e,t,o){n.push({event:e,callback:t,object:o})},broadcast:function(e,t,o){void 0===o&&(o=null),$.each(n,function(){var n=!1;this.event.indexOf("*")!==-1&&e.indexOf(this.event.replace("*",""))!==-1&&(n=!0),((void 0===o||null===o)&&e===this.event||void 0!==o&&null!==o&&JSON.stringify(o)===JSON.stringify(this.object)&&e===this.event||n)&&this.callback(t)})},remove:function(e){void 0!==e?$.each(n,function(t){this.event===e&&n.splice(t,1)}):n=[]}}}(akimbo),function(e){function t(){this.config=new e.Config,this.component=new e.Component,this.event=new e.Event}function n(e){c=!0,o.apply(e),i.apply(e),a.apply(e),r.apply(e),$(document).on("click","a[disabled]",function(e){e.preventDefault()}),document.addEventListener("click",function(e){$(e.target).closest("a[disabled]").length&&(e.stopImmediatePropagation(),e.preventDefault())},!0),c=!1}function o(){$("*").unbind().off().stop(!0,!0),$(window).off(),$(document).off(),this.event.remove(),null!==l&&(this.component.setLayoutHasLoaded(!1),this.component.unload())}function i(){l=new this.component.load(e.App.Core),void 0!==l.constructor&&l.constructor(l),void 0!==l.before&&l.before(l)}function a(){var t=e.App.Controllers[s.controller];if(void 0===t)throw"akimbo.App.Controllers."+s.controller+" does not exist";t=new this.component.load(e.App.Controllers[s.controller]),u&&$("body").removeClass(),void 0!==t.meta&&void 0!==t.meta.templateClass&&$("body").addClass(t.meta.templateClass),(history.length>1||1===history.length&&""!==d)&&window.location.pathname.replace("/","")!==d&&history.pushState({page:d},null,"/"+d),t.segments=p}function r(){var e=this;this.event.listen("layout.loaded",function(){new e.component.loadComponents(l.meta.components),setTimeout(function(){void 0!==l.after&&l.after(l)},50)})}e.Router=t;var l=null,c=!1,s={},d="",u=!0,p=[];t.prototype={navigate:function(e,t){var o=this,i=!1;if(p=e.split("/"),u=t!==!1,!c){var a=o.config.get("routes");for(var r in o.config.get("routes"))e===a[r].path&&(i=!0,d=e,s=a[r],n(o));if(!i)throw'"'+e+'" route not found'}},isProtectedRoute:function(){return s.protected}}}(akimbo),function(e){function t(t){if(void 0===t.name)throw'Service "name" param must be specified';this.listeners={},this.name=t.name,this.serviceUrl=t.serviceUrl,this.uri=t.uri,this.events=$.extend(!0,{create:{done:"create.done",fail:"create.fail",complete:"create.complete"},read:{done:"read.done",fail:"read.fail",complete:"read.complete"},update:{done:"update.done",fail:"update.fail",complete:"update.complete"},destroy:{done:"destroy.done",fail:"destroy.fail",complete:"destroy.complete"},index:{done:"index.done",fail:"index.fail",complete:"index.complete"}},t.overrideEvents),function(t){t.config=new e.Config,t.cache=new e.Cache,t.event=new e.Event}(this)}e.Service=t,t.prototype.name=t.name,t.prototype.create=function(e,t,n){var o=this,i=$.extend(!0,this.events,n);this.listeners.create=$.ajax({url:this.serviceUrl+"/"+this.uri,type:"POST",data:e,contentType:"application/json"}).done(function(e){o.event.broadcast(i.create.done,e,void 0!==t&&null!==t?$.extend({},o,t):o)}).fail(function(e){o.event.broadcast(i.create.fail,void 0!==e.responseJSON?e.responseJSON:e,void 0!==t&&null!==t?$.extend({},o,t):o)}).complete(function(){o.event.broadcast(i.create.complete,null,void 0!==t&&null!==t?$.extend({},o,t):o)})},t.prototype.read=function(e,t,n){var o=this,i=$.extend(!0,this.events,n),a="read";void 0!==e&&null!==e&&void 0!==e.identifier&&(a=e.identifier),this.listeners.read=$.ajax({url:this.serviceUrl+"/"+this.uri+"/"+a,type:"GET",headers:e}).done(function(e){o.event.broadcast(i.read.done,e,void 0!==t&&null!==t?$.extend({},o,t):o)}).fail(function(e){o.event.broadcast(i.read.fail,void 0!==e.responseJSON?e.responseJSON:e,void 0!==t&&null!==t?$.extend({},o,t):o)}).complete(function(){o.event.broadcast(i.read.complete,null,void 0!==t&&null!==t?$.extend({},o,t):o)})},t.prototype.update=function(e,t,n){var o=this,i=$.extend(!0,this.events,n);this.listeners.update=$.ajax({url:this.serviceUrl+"/"+this.uri,type:"PUT",data:e,contentType:"application/json"}).done(function(e){o.event.broadcast(i.update.done,e,void 0!==t&&null!==t?$.extend({},o,t):o)}).fail(function(e){o.event.broadcast(i.update.fail,void 0!==e.responseJSON?e.responseJSON:e,void 0!==t&&null!==t?$.extend({},o,t):o)}).complete(function(){o.event.broadcast(i.update.complete,null,void 0!==t&&null!==t?$.extend({},o,t):o)})},t.prototype.destroy=function(e,t,n){var o=this,i=$.extend(!0,this.events,n);this.listeners.update=$.ajax({url:this.serviceUrl+"/"+this.uri,type:"DELETE",data:e,contentType:"application/json"}).done(function(e){o.event.broadcast(i.destroy.done,e,void 0!==t&&null!==t?$.extend({},o,t):o)}).fail(function(e){o.event.broadcast(i.destroy.fail,void 0!==e.responseJSON?e.responseJSON:e,void 0!==t&&null!==t?$.extend({},o,t):o)}).complete(function(){o.event.broadcast(i.destroy.complete,null,void 0!==t&&null!==t?$.extend({},o,t):o)})},t.prototype.index=function(e,t,n){var o=this,i=$.extend(!0,this.events,n);this.listeners.index=$.ajax({url:this.serviceUrl+"/"+this.uri,type:"GET",headers:e}).done(function(e){o.event.broadcast(i.index.done,e,void 0!==t&&null!==t?$.extend({},o,t):o)}).fail(function(e){o.event.broadcast(i.index.fail,void 0!==e.responseJSON?e.responseJSON:e,void 0!==t&&null!==t?$.extend({},o,t):o)}).complete(function(){o.event.broadcast(i.index.complete,null,void 0!==t&&null!==t?$.extend({},o,t):o)})},t.prototype.cancel=function(e){void 0!==e?null!==this.listeners[e]&&this.listeners[e].abort():$.each(this.listeners,function(){this.abort()})},t.prototype.listen=function(e,t,n){if(void 0===n)throw'listener "object" parameter must be specified for '+this.name;this.event.listen(e,t,void 0!==n&&null!==n?$.extend({},this,n):this)}}(akimbo),function(e){function t(){}e.Template=t,t.prototype={render:function(e,t,n){var o=t;return $.each(e,function(e,t){o=o.replace(new RegExp("{{"+e+"}}","g"),t)}),n.append(o),n.find("a").on("click",function(e){e.preventDefault()}),o}}}(akimbo);